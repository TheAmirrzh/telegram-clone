<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.ListView?>
<?import javafx.scene.control.MenuButton?>
<?import javafx.scene.control.MenuItem?>
<?import javafx.scene.control.TextField?>
<?import javafx.scene.image.Image?>
<?import javafx.scene.image.ImageView?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.Region?>
<?import javafx.scene.layout.StackPane?>
<?import javafx.scene.layout.VBox?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.SplitPane?>

<VBox xmlns:fx="http://javafx.com/fxml/1" fx:controller="com.telegramapp.ui.controllers.MainController"
      styleClass="main-container" fx:id="mainContainer">

  <!-- Top Toolbar -->
  <HBox alignment="CENTER_LEFT" styleClass="top-toolbar">
    <padding>
      <Insets top="8" right="12" bottom="8" left="12"/>
    </padding>

    <!-- *** THIS IS THE FIX *** -->
    <!-- Re-added the logo ImageView that was missing -->
    <ImageView fx:id="logoImageView" fitHeight="40" fitWidth="40" preserveRatio="true">
      <image>
        <Image url="@../assets/telegram_logo.png"/>
      </image>
    </ImageView>
    <Region HBox.hgrow="ALWAYS"/>

    <HBox fx:id="profileContainer" alignment="CENTER_LEFT" spacing="10" styleClass="profile-bubble">
      <ImageView fx:id="profileImageView" fitHeight="40" fitWidth="40"/>
      <VBox alignment="CENTER_LEFT">
        <Label fx:id="profileNameLabel" text="Profile Name"/>
        <Label fx:id="profileUsernameLabel" text="@username" styleClass="username-label"/>
      </VBox>
    </HBox>
    <Region HBox.hgrow="ALWAYS"/>
    <Button onAction="#onManageContacts" styleClass="button" text="Contacts"/>
    <StackPane fx:id="themeToggleContainer" styleClass="theme-toggle-container">
      <children>
        <ImageView fx:id="sunIcon" fitHeight="20" fitWidth="20" styleClass="theme-icon">
          <image>
            <Image url="@../assets/sun_icon.png"/>
          </image>
        </ImageView>
        <ImageView fx:id="moonIcon" fitHeight="20" fitWidth="20" styleClass="theme-icon">
          <image>
            <Image url="@../assets/moon_icon.png"/>
          </image>
        </ImageView>
      </children>
    </StackPane>
  </HBox>

  <!-- Main Content Area -->
  <SplitPane dividerPositions="0.3" styleClass="main-split-pane" VBox.vgrow="ALWAYS">
    <items>
      <!-- Sidebar -->
      <VBox styleClass="sidebar">
        <!-- Search and Actions -->
        <HBox alignment="CENTER" spacing="5" styleClass="sidebar-header">
          <padding><Insets top="8" right="8" bottom="8" left="8"/></padding>
          <TextField fx:id="globalSearchField" promptText="Search" HBox.hgrow="ALWAYS"/>
          <MenuButton text="+" styleClass="button">
            <items>
              <MenuItem text="New Chat" onAction="#onNewChat"/>
              <MenuItem text="New Group" onAction="#onNewGroup"/>
              <MenuItem text="New Channel" onAction="#onNewChannel"/>
            </items>
          </MenuButton>
        </HBox>

        <!-- Chat Lists / Search Results -->
        <StackPane VBox.vgrow="ALWAYS">
          <VBox fx:id="chatListsContainer">
            <VBox VBox.vgrow="ALWAYS">
              <padding><Insets top="8" right="8" bottom="8" left="8"/></padding>
              <Label text="Contacts" styleClass="list-header"/>
              <ListView fx:id="usersListView" VBox.vgrow="ALWAYS"/>
            </VBox>
            <VBox VBox.vgrow="ALWAYS">
              <padding><Insets top="8" right="8" bottom="8" left="8"/></padding>
              <Label text="Groups" styleClass="list-header"/>
              <ListView fx:id="groupsListView" VBox.vgrow="ALWAYS"/>
            </VBox>
            <VBox VBox.vgrow="ALWAYS">
              <padding><Insets top="8" right="8" bottom="8" left="8"/></padding>
              <Label text="Channels" styleClass="list-header"/>
              <ListView fx:id="channelsListView" VBox.vgrow="ALWAYS"/>
            </VBox>
          </VBox>

          <!-- Search Results Container -->
          <StackPane fx:id="searchResultsContainer" styleClass="search-results-pane" visible="false">
            <ListView fx:id="searchResultsListView"/>
          </StackPane>
        </StackPane>

      </VBox>

      <!-- Main chat area -->
      <StackPane fx:id="chatArea" styleClass="chat-area-background">
        <children>
          <VBox alignment="CENTER" spacing="10">
            <ImageView fitHeight="100" fitWidth="100">
              <image><Image url="@../assets/telegram_logo.png" />
              </image>
            </ImageView>
            <Label fx:id="chatAreaPlaceholder" text="Select a contact to begin messaging" styleClass="chat-area-placeholder"/>
          </VBox>
        </children>
      </StackPane>
    </items>
  </SplitPane>
</VBox>

